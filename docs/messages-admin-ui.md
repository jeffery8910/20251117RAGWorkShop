# messages-admin-ui：cloud-app 管理後台 `/admin` 文案說明

這份文件整理 `/admin` 管理介面裡會看到的主要文字、按鈕與提示，目標是：

- 讓參與者只看畫面與這份說明，就知道每個區塊在做什麼。
- 方便之後統一調整 UI 文案（不用到處找字串）。

> 對應的 React 元件主要在：`cloud-app/src/app/admin` 與 `cloud-app/src/components/*`。  
> 後端 API 行為則補充在 `docs/09-admin-web-management.md`。

---

## 入口與版頭

### AdminGate：輸入 Admin Token

- 標題 / 說明（建議文字）：
  - 標題：`管理者登入`
  - 說明：`請輸入 Admin Token 才能進入管理後台。此 Token 只會儲存在本機瀏覽器，不會顯示在畫面上。`
- 欄位：
  - `Admin Token`：提示 `請輸入雲端環境設定的 ADMIN_TOKEN`
- 按鈕：
  - `確認並登入`：按下後會呼叫 `/api/admin/ping` 測試 Token 是否有效。
- 成功／失敗訊息：
  - 成功：`驗證成功，已登入管理後台。`
  - 失敗：`驗證失敗，請確認 Admin Token 是否正確。`
- 其他：
  - Token 會以 `localStorage.adminToken` 儲存在瀏覽器。
  - 可以提供一個 `登出` 按鈕：`清除本機儲存的 Admin Token 並重新登入。`

### `/admin` 頁面標題區

- 標題（已在程式中調整）：
  - `RAG ＋ LINE 管理後台`
- 說明文字：
  - `在這裡設定回覆策略、知識庫與（選用）n8n 工作流程，讓 LINE 機器人能安全讀取你的文件並回覆使用者。`
- 右上連結：
  - 文字：`查看對話紀錄`
  - 目的：導向 `/admin/conversations`，查看使用者與機器人的來回訊息。

---

## Tabs：各分頁名稱

對應 `Tabs` 元件的標籤文字，建議固定如下：

1. `系統設定`
2. `檔案上傳`
3. `純文字上傳`
4. `線上測問`
5. `資料管理`
6. `記錄查詢`

> 對話紀錄 `/admin/conversations` 是另外一個路由，不是同一個 Tab。

---

## 系統設定（ConfigPanel）

對應元件：`src/components/ConfigPanel.tsx`

- **系統回覆說明（Prompt）**
  - 標籤：`系統回覆說明（Prompt）`
  - placeholder 範例：
    - `請描述這個助理的角色、語氣與回答範圍，例如：你是本單位的客服助理，請參考知識庫內容，用繁體中文回答使用者問題。`

- **關鍵字（keywords）**
  - 標籤：`關鍵字（啟動 RAG 的文字，不是 LINE 後台的關鍵字）`
  - Info 提示：
    - `這裡設定的是 cloud-app 自己判斷的關鍵字，用來決定什麼時候啟動 RAG 回答。LINE 官方帳號後台的「關鍵字自動回覆」請分開設定，若要交給 LINE 原生回覆，可以在 keywordRules 中設定 mode:"native"。`
  - placeholder：
    - `例如：help, 課表, 報名`

- **TOPK**
  - 標籤：`TOPK`
  - Info 提示：
    - `每次檢索要取回多少筆文件來組成回答。數字越大越精準但越慢，建議 4～8。`

- **SCORE_THRESHOLD**
  - 標籤：`SCORE_THRESHOLD`
  - Info 提示：
    - `向量相似度門檻（0～1）。越高代表只接受非常相似的文件，建議 0.10～0.30。`

- **NUM_CANDIDATES**
  - 標籤：`NUM_CANDIDATES`
  - Info 提示：
    - `向量搜尋時初步掃描的候選文件數量。數字越大越精準但越耗資源，建議 200～800。`

- **n8n Webhook URL**
  - 標籤：`n8n Webhook URL（FORWARD_TO_N8N_URL）`
  - Info 提示：
    - `若希望由 n8n workflow 處理 LINE 訊息，請填入 n8n 的 Webhook URL，例如 https://your-n8n.onrender.com/webhook/line/webhook。留白代表不啟用轉發，由 cloud-app 直接執行 RAG 回覆。`
  - placeholder：
    - `https://your-n8n-host/webhook/line/webhook`

- **n8n 轉發規則**
  - 標籤：`n8n 轉發規則（FORWARD_RULE）`
  - Info 提示：
    - `all：所有訊息都轉發到 n8n，由 n8n 回覆 LINE。keywords：只有命中關鍵字規則的訊息才轉發，其餘在 cloud-app 直接用 RAG 回覆。`
  - 下拉選項：
    - `""`：`不轉發到 n8n（全部由 cloud-app 處理）`
    - `"all"`：`all：所有 LINE 訊息都交給 n8n`
    - `"keywords"`：`keywords：只有關鍵字命中的才交給 n8n`

- **儲存按鈕**
  - 文字：
    - 預設：`儲存設定`
    - loading：`儲存中…`

---

## 檔案上傳（UploadPanel）

- 分頁標籤：`檔案上傳`
- 主要欄位與文案：
  - `選擇檔案`：支援多檔，上傳 PDF / TXT / MD / DOCX。
  - `Chunk 大小（字元數）`：說明建議值，例如 800。
  - `重疊字元數`：說明建議值，例如 120。
  - 按鈕：`開始上傳`

- 進度與結果訊息：
  - 上傳中：`已上傳 X MB / Y MB`
  - 上傳完成後等待處理：`上傳完成，正在解析與寫入向量…`
  - 成功摘要：`已成功寫入 N 筆片段。`
  - 若有錯誤：`已成功寫入 N 筆片段，發生 E 筆錯誤，可展開檢視詳細原因。`

---

## 純文字上傳（TextUploadPanel）

- 分頁標籤：`純文字上傳`
- 欄位：
  - `內容`：多行文字輸入框。
  - `來源名稱（source）`：用來在資料管理中辨識這批內容，例如 `faq-2025-01`。
- 按鈕：
  - `上傳文字`
- 成功訊息：
  - `已成功寫入 N 筆片段。`

---

## 線上測問（TestPanel）

- 分頁標籤：`線上測問`
- 欄位：
  - 問題輸入框 placeholder：`請輸入一個你想測試的問題`
- 按鈕：
  - `送出測試`
  - loading：`產生回答中…`
- 顯示區：
  - 回答結果區塊標題：`系統回答`
  - 若沒有答案：`（目前沒有可用的回答）`

---

## 資料管理（DataManagementPanel）

- 分頁標籤：`資料管理`
- Drop-down：
  - 標籤：`選擇要管理的來源`
  - placeholder：`請先選擇一個來源`
- 按鈕與提示：
  - `重新整理來源列表`
  - `刪除該來源所有文件`
    - 確認對話：`確定要刪除來源「${source}」的所有文件嗎？此動作無法復原。`
  - `重新嵌入該來源`
    - 確認對話：`將重新計算來源「${source}」所有文件的向量，可能需要一些時間，確定要開始嗎？`
  - `清空整個向量集合`
    - 確認對話：`將清除所有向量資料（例如 Atlas docs / Qdrant collection）。請先確認已備份，確定要執行嗎？`
- 成功／錯誤訊息：
  - 刪除成功：`已刪除來源 ${source} 的所有文件。`
  - 重新嵌入成功：`已重新處理 ${reembedded} 筆文件。`
  - 清空成功：`已清空向量集合。`

---

## 記錄查詢（LogsPanel）

- 分頁標籤：`記錄查詢`
- 按鈕：
  - `載入最新記錄`
- 顯示欄位（建議表頭）：
  - `時間`
  - `類型`
  - `訊息 / 查詢內容`
  - `詳細資訊`
- 失敗訊息：
  - `讀取記錄失敗，請稍後再試。`

---

## 對話紀錄頁面 `/admin/conversations`

（不在 Tabs 裡，由首頁右上角連結進入）

- 搜尋條件：
  - `使用者 ID`
  - `Channel`
  - `關鍵字`
  - `起始時間`
  - `結束時間`
  - 按鈕：`搜尋對話`
- 列表欄位：
  - `時間`
  - `方向`（使用者 → 機器人）
  - `類型`（message / reply / error）
  - `使用者`
  - `內容`
- 點擊某一列 → 開啟 `/admin/conversations/[id]` 詳細頁。

### `/admin/conversations/[id]` 詳細頁

- 顯示：
  - `時間`
  - `方向`
  - `類型`
  - `使用者 ID`
  - `內容`
  - 若有 RAG 命中結果：`相關文件列表（來源 / 頁碼 / 分數）`

---

## 健康檢查頁 `/admin/setup`

這一頁主要給講師／維運人員快速檢查環境設定是否完整。

- 區塊 1：健康檢查
  - 標題：`環境／連線健康檢查`
  - 顯示：
    - `LOG_PROVIDER（目前）`
    - 是否啟用 DB 檢查（Atlas / Qdrant / Postgres / MySQL 等）
  - 按鈕：
    - `切換 DB 檢查`
    - `重新檢查`
  - 表格欄位：
    - `項目`
    - `狀態（OK / FAIL）`
    - `詳細資訊`

- 區塊 2：環境變數摘要
  - 標題：`環境變數檢查（必填 / 已填 / 缺少）`
  - 表格欄位：
    - `類別`
    - `必填鍵名`
    - `已填`
    - `缺少`

---

## 小結：文案設計原則

- 盡量避免技術名詞疊加（例如「向量檢索 RAG pipeline」），改成操作導向的說法。
- 所有按鈕都用「動詞＋對象」命名，例如 `上傳文字`、`清空向量集合`。
- Info 提示專注說「什麼時候該調整」「調太大／太小會怎樣」，避免長篇技術背景。
- 讓管理者只要理解這份文件與畫面文字，就可以完成設定，不需要打開程式碼。 
