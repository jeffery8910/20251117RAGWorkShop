# 00（附錄）必要環境變數一覽（cloud-app/.env）

這份檔案列出 cloud-app 在工作坊情境下會用到的環境變數，方便你在 Vercel / Render / 本機 `.env` 中設定。

> 詳細說明可以搭配 `docs/00-overview-env.md` 一起看，這裡只保留最重要的鍵值速查。  
> 本路線不再使用 Atlas Data API，向量搜尋一律走 Qdrant。

---

- 最基本（cloud-app 必填）
  - `ADMIN_TOKEN`  
    - 自行設定一組長一點的密碼字串，用來登入 `/admin` 後台。
  - `GEMINI_API_KEY`  
    - 到 Google AI Studio → Project → API Keys 建立；詳見 `docs/02-google-ai-studio-api-key.md`。
  - `EMBED_MODEL`、`GEN_MODEL`  
    - 預設為 `text-embedding-004`、`gemini-2.5-flash`，可直接沿用。
  - `LINE_CHANNEL_SECRET`、`LINE_CHANNEL_ACCESS_TOKEN`  
    - LINE Developers → Messaging API Channel：Secret 在 Basic settings，Access token 在 Messaging API → Issue。  
      參考 `docs/07-line-developers-setup.md`。
  - `VECTOR_BACKEND`  
    - 預設 `qdrant`（搭配 Qdrant Cloud）。
  - `QDRANT_URL`、`QDRANT_API_KEY`、`QDRANT_COLLECTION`  
    - 到 Qdrant Cloud Console → Cluster 頁面複製 REST URL 與 API Key。  
      Collection 名稱建議使用 `workshop_rag_docs`。  
      設定流程見 `docs/03-qdrant-cloud-setup.md`。

- 對話紀錄與設定儲存（選配，預設關閉）
  - 預設：`LOG_PROVIDER=none`
  - 若要改用 MongoDB Atlas（Driver，而非 Data API）：
    - `LOG_PROVIDER=atlas-driver`
    - `MONGODB_URI`、`MONGODB_DB`
    - 可再加：`MONGODB_COLLECTION_LOGS`、`MONGODB_COLLECTION_CONVERSATIONS`、`MONGODB_COLLECTION_CONFIG`
  - 若用 Postgres：
    - `LOG_PROVIDER=pg`
    - `DATABASE_URL`（例如 Vercel Postgres / Neon 提供的連線字串）
  - 若用 MySQL：
    - `LOG_PROVIDER=mysql`
    - `MYSQL_URL`
  - 若用 Supabase：
    - `LOG_PROVIDER=supabase`
    - `SUPABASE_URL`、`SUPABASE_SERVICE_ROLE_KEY`

- 建議但可選
  - Gemini 流量及重試控制（避免配額暴衝，可視需要加）：
    - `GEMINI_GEN_RPM=10`、`GEMINI_GEN_MAX_CONCURRENCY=1`
    - `GEMINI_EMBED_RPM=100`、`GEMINI_EMBED_MAX_CONCURRENCY=1`
    - `GLOBAL_RETRY_MAX=4`、`GLOBAL_RETRY_BASE_MS=500`、`GLOBAL_RETRY_MAX_DELAY_MS=5000`
  - 若希望把回答交給外部 API 處理：
    - `ANSWER_WEBHOOK_URL`、`ANSWER_WEBHOOK_TOKEN`、`ANSWER_WEBHOOK_TIMEOUT_MS=15000`
  - Embedding 維度（只在使用 `gemini-embedding-001` 時需要）：
    - `EMBED_DIM=768`  
      若你改用 `gemini-embedding-001`，請把 Qdrant collection 也一併重建成 768 維；或在 `/admin` 中清空向量庫再重新上傳。

備註
- GitHub Codespaces 的 Secrets 可以跟 Vercel / Render 共用概念，但實際部署時仍需在對應平台填入一次。  
- 可以參考 `cloud-app/.env.local.sample` 作為模板，把需要的 key 抽出來貼到 Vercel / Render 的 Environment Variables。

快速自我檢查
- Gemini Key：依 `docs/02-google-ai-studio-api-key.md` 的 curl 測試，確認 API Key 有效。
- Qdrant：依 `docs/03-qdrant-cloud-setup.md` 的 curl `/collections` 測試，確認 URL / API Key 正確。
